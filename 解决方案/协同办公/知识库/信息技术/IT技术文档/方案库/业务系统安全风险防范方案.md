方案背景

风险（Risk），从一般意义上理解，是指遭受损失、伤害、不利或者毁灭的可能性。风险的防范就是采取符合成本效益的措施防止遭受风险或者降低风险。

业务系统由于是通过Internet提供给用户使用，因此除了防范来自内部的安全风险之外，必须防范来自Internet上的安全风险。安全风险防范上应该注重以下两个方面：

安全风险的预防（回避、控制）
彻底解决因为发生风险后的恢复问题
安全风险的预防
风险以预防为主，控制为辅。通过预防回避风险，降低损失的概率。通过控制降低和消灭风险，减少风险发生后的损失。

风险的预防的切入点是从上到下从外到内的基本方式。下面的预防措施也基本上会按照这种基本方式进行组织预防方案的内容。

安全风险预防原则
最小特权原则，只分配合适的权限；

防范方法、风险预防措施
人员安全
业务系统的管理人员、使用人员等应该尽忠职守、尽职尽责，坚持职业操守和道德底线，强化自身安全素质和安全技能
对用户保持敬畏
账号安全
首先要确保关键业务所在的服务平台的账号的安全，这些账号包括阿里云账号、存储账号信息的计算机等信息系统的账号等。

阿里云的账号保护

阿里云账号的管理。由于阿里云账号的安全策略设定，只允许常用IP地址登录，其他IP需要短信验证码验证登录，相对来说比较安全。因此做好账号和密码的保管，手机验证码不能轻易给他人使用。
与阿里云的账号具有相同效力的还有阿里云的AccessKey，AccessKey由于在使用上具有明文性和一般不会改动的性质，在保管和使用上应该更加注意。
待办：查找AccessKey在使用和保管上存在问题的地方，权限应该缩小的应予以缩小，权限应该收回的应该予以收回
账号注册安全和规范

注册账号应该优先使用公司注册信息，如使用公司邮箱、手机号、名称等；
密码应该满足复杂性要求；
账号和密码应该妥善保管；
注册信息应该在信息技术部备档；
基础设施安全
基础设施是指服务器、负载均衡、存储等底层硬件。目前基础设施大部分由阿里云提供。

应当妥善和正确配置防火墙等安全方面的虚拟设备或者设置（如主机安全组、云盾）等，特别是对远程访问的限制；
基础设施的接入（SSH连接、远程桌面连接、数据文件传输、数据库远程连接等）应该通过安全的途径或者通道。采用白名单的方式，仅允许公司内（专线）连接和通过VPN连接，不允许直接将远程访问端口暴露在Internet上；
远程访问权限应该遵循最小权限原则，只分配给最少的人和仅需的权限；
服务器、存储数据应当定期备份（如磁盘快照），以避免基于操作系统层面的数据备份不可用导致的备份数据无法恢复的情况；
做好和利用好监控和日志；
操作系统安全
操作系统应该安装杀毒软件、hids、开启防火墙；
对系统管理员账户进行保护，如重命名、定期更换安全的密码；
操作系统应该保持安全更新；
不安装无关软件和不安全的软件，以减少被攻击面，从而降低安全风险；
登录系统或者执行变更后产生的临时文件、垃圾文件等应该及时处理，不能留在服务器磁盘上；
废弃的服务、软件环境等应该及时清除，数据备份产生的老旧备份和服务产生的日志文件等也应该及时清理；
操作系统在允许的情况下可以使用系统还原、服务器备份等功能保证操作系统的数据安全；
做好和利用好监控和日志，定期更新阿里云安全插件（如安骑士、云监控等）
做好安全基线检查
做好安全基线检查（举例）

对于Windows服务器
应启用安全审计功能，审计覆盖到每个用户，对重要的用户行为和重要安全事件进行审计；如对于Windows服务器，在管理工具打开本地安全策略，打开路径:安全设置\本地策略\审核策略，将全部审核策略配置为：成功,失败。包括审核策略更改、审核对象访问、审核进程跟踪、审核目录服务访问、审核账户登陆事件、审核特权使用、审核系统事件、审核账户管理、审核登陆事件共九项。
配置账户锁定策略，降低被爆破和猜测风险；如对于Windows服务器，在管理工具打开本地安全策略，打开路径:安全设置\帐户策略\账户锁定策略。将账户锁定阈值设置为3-8之间，建议值为5，输错5次密码锁定账户；然后将账户锁定时间和重置账户锁定计数器设置为10-30之间，建议值为15，账户锁定时间为15分钟。
设置密码使用期限策略，设置密码使用期限策略,减少密码被泄漏和猜测风险；在管理工具打开本地安全策略，打开路径:安全设置\帐户策略\密码策略，将密码最长使用期限设置为30-180之间，建议值为90，将密码最短使用期限设置为1-14之间，建议值为7.
密码复杂性配置，设置强密码，减少密码被泄漏和猜测风险；在管理工具打开本地安全策略，打开路径:安全设置\帐户策略\密码策略，将密码必须符合复杂性要求设置为已启用，将密码最小长度设置为8以上。
强制密码历史'设置为5-24之间，设置强制密码历史,防止重复使用最近使用过的密码；在管理工具打开本地安全策略，打开路径:安全设置\帐户策略\密码策略，将强制密码历史设置为5-24之间
配置账户锁定策略，配置账户锁定策略，降低被爆破和猜测风险；在管理工具打开本地安全策略，打开路径:安全设置\帐户策略\账户锁定策略。将账户锁定阈值设置为3-8之间，建议值为5，输错5次密码锁定账户；然后将账户锁定时间和重置账户锁定计数器设置为10-30之间，建议值为15，账户锁定时间为15分钟。
匿名账户访问控制，匿名账户访问控制；在管理工具打开本地安全策略，打开路径:安全设置\本地策略\安全选项。将网络访问中“Everyone权限应用于匿名用户“设置为：已禁用，将“不允许SAM帐户的匿名枚举“设置为：已启用，将“不允许SAM帐户和共享的匿名枚举”设置为：已启用，将”允许匿名SID/名称转换“设置为：已禁用。
禁止未登录强制关机；在管理工具打开本地安全策略，打开路径:安全设置\本地策略\安全选项。将"关机:允许在未登录时关闭系统"设置为:已禁用
对于Linux服务器
检查密码重用是否受限制，强制用户不重用最近使用的密码，降低密码猜测攻击风险；在/etc/pam.d/password-auth和/etc/pam.d/system-auth中password sufficient pam_unix.so 这行的末尾配置remember参数为5-24之间，原来的内容不用更改, 只在末尾加了remember=5。
确保SSH LogLevel设置为INFO,记录登录和注销活动；编辑 /etc/ssh/sshd_config 文件以按如下方式设置参数(取消注释): LogLevel INFO
设置SSH空闲超时退出时间,可降低未授权用户访问其他用户ssh会话的风险；
编辑/etc/ssh/sshd_config，将ClientAliveInterval 设置为300到900，即5-15分钟，将ClientAliveCountMax设置为0-3。

ClientAliveCountMax 2

SSHD强制使用V2安全协议；编辑 /etc/ssh/sshd_config 文件以按如下方式设置参数： Protocol 2

确保SSH MaxAuthTries设置为3到6之间，设置较低的Max AuthTrimes参数将降低SSH服务器被暴力攻击成功的风险。在/etc/ssh/sshd_config中取消MaxAuthTries注释符号#，设置最大密码尝试失败次数3-6，建议为4：MaxAuthTries 4
设置密码修改最小间隔时间，设置密码修改最小间隔时间，限制密码更改过于频繁；在 /etc/login.defs 中将 PASS_MIN_DAYS 参数设置为7-14之间,建议为7： PASS_MIN_DAYS 7 需同时执行命令为root用户设置： chage --mindays 7 root
设置密码失效时间，设置密码失效时间，强制定期修改密码，减少密码被泄漏和猜测风险，使用非密码登陆方式(如密钥对)请忽略此项。使用非密码登陆方式如密钥对，请忽略此项。在 /etc/login.defs 中将 PASS_MAX_DAYS 参数设置为 60-180之间，如 PASS_MAX_DAYS 90。需同时执行命令设置root密码失效时间： chage --maxdays 90 root。
密码复杂度检查，检查密码长度和密码是否使用多种字符类型；编辑/etc/security/pwquality.conf，把minlen（密码最小长度）设置为9-32位，把minclass（至少包含小写字母、大写字母、数字、特殊字符等4类字符中等3类或4类）设置为3或4。如： minlen=10 minclass=3
应用安全
包括应用服务本身、二进制文件、代码安全，平台安全（数据库安全）等。

应用服务的启动账户不能为root账户和具有sudo完全权限的账户，启动服务的账户应该设定为单独的用户，每一个服务应该有对应的账户或者同一组服务使用相同的账户；
启动服务的账户（服务专用账户）shell应该为/sbin/nologin，home目录可为/dev/null，Windows系统应该配置为禁止远程登录等；
已经发布的代码或者二进制文件应该有发版记录，以用于在紧急时刻回滚版本或者恢复时使用；
已经发布的代码应该安全保存在代码仓库（gitlab）内；
应用在设计上应该考虑安全因素，数据库设计上应该考虑数据冗余等；
应用在设计上应该允许用户导出数据，这些数据包括数据库和系统运行所需要的所有用户数据，允许用户备份数据到用户本地；
可以定期提醒用户做好数据备份，通过导出功能，将应用所需要的数据的副本保存在用户手中；
做好和利用好监控和日志
做好应用安全基线检查，Redis安全基线检查
数据安全
包括用户数据、备份数据等。

在允许的情况下可以使用系统还原、服务器备份等功能保证操作系统的数据安全；
导出的数据应该妥善使用、存取，防止数据丢失和泄露；
数据的操作应该符合安全变更的原则，变更应该有记录、checklist和二次核对措施等；
账号和凭据等应该妥善使用和保管，在使用一些管理工具或者一些配置（数据库等管理工具记住密码功能，配置文件明文配置等）时应该仔细了解和确保它在安全方面上可能引发的问题；
流程安全
信息技术部门应该针对业务系统的情况制定适合的流程保证业务的安全运行，研发部门作为IT系统的主要使用者也应该建立操作规范，共同为安全负责；
建立事件响应能力，对事件响应做好充分的准备；
环境搭建、环境部署、配置变更、服务启动停止等操作应该有测试通过或者经过反复验证的操作文档和手册，保证员工离职、请假等情况发生后有人能接手操作；
--end--